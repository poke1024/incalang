// This file is part of incalang.

// incalang is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
//(at your option) any later version.

// incalang is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.

// You should have received a copy of the GNU General Public License
// along with Foobar; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

#include "machine.h"
#include <math.h>

BEGIN_MACHINE_NAMESPACE

#if __VISC__
#pragma warning( once : 4305 )
#endif

static const float table[ 1024 * 3 ] = {
	-0.802129, 0.113849, 0.586197, 0.735661, 0.316109, 0.599064, 0.135499, -0.987958, 0.0746964, 0.623142, 0.0754707, 0.778459, 
	0.398969, -0.775282, -0.489655, 0.88983, -0.431239, -0.149113, 0.853727, -0.321623, -0.409522, -0.337792, 0.897771, 0.282673, 
	0.304254, -0.809726, -0.50177, -0.571, 0.801206, 0.178963, 0.456685, -0.838704, -0.296673, 0.0265368, -0.381412, -0.924024, 
	-0.619637, 0.0784578, 0.780957, -0.732401, -0.647008, -0.212058, -0.627671, -0.7482, 0.215001, 0.36626, 0.912292, 0.183241, 
	0.606899, -0.215399, -0.765034, 0.0907594, -0.22289, -0.970609, 0.634145, 0.658843, -0.404704, -0.305644, -0.928072, -0.212752, 
	-0.577565, 0.709369, 0.403999, 0.375685, -0.822164, 0.427677, -0.267442, -0.175943, 0.947375, -0.201991, -0.615219, -0.76204, 
	0.73673, -0.431135, -0.520915, -0.295621, 0.70217, 0.647739, 0.73136, -0.680102, 0.0507421, 0.179366, -0.146121, -0.97287, 
	0.458994, -0.553914, -0.694625, 0.14355, -0.844723, 0.515593, -0.549821, 0.494155, -0.673429, -0.0739001, 0.580685, 0.810767, 
	-0.912705, 0.0824937, 0.400206, -0.164426, 0.0255901, -0.986057, 0.952693, 0.271601, -0.136417, 0.534883, 0.597691, -0.597216, 
	0.276799, 0.293472, 0.915017, -0.691333, 0.0904766, -0.716849, -0.468214, 0.657556, -0.590251, 0.567436, 0.286221, 0.772071, 
	0.315841, 0.667884, 0.673926, -0.433845, -0.656257, 0.617338, -0.445553, 0.825315, 0.346899, 0.993936, -0.105273, 0.0317511, 
	0.491023, 0.214429, -0.844344, -0.41457, -0.775542, 0.476095, -0.877509, -0.402351, -0.260944, 0.82023, 0.228995, -0.524199, 
	-0.098377, 0.849598, -0.518174, 0.882175, -0.115027, 0.456658, 0.241435, 0.666687, -0.705151, -0.0433298, -0.847968, 0.528274, 
	-0.350099, 0.823855, 0.44575, 0.500878, -0.801325, 0.327107, 0.566206, -0.538885, -0.623709, 0.5983, -0.773309, -0.209832, 
	0.127756, -0.858963, 0.495844, -0.315207, 0.949008, 0.0053702, 0.0585314, -0.0825601, -0.994866, -0.112391, 0.0275189, -0.993283, 
	-0.122205, 0.952044, -0.280496, 0.159477, 0.890963, -0.425149, 0.656857, -0.741888, -0.134692, 0.35796, -0.154347, -0.920892, 
	-0.974002, 0.197215, -0.111474, 0.0191356, 0.676621, -0.736083, -0.002452, 0.958857, 0.283877, 0.937989, -0.338833, 0.073269, 
	0.798958, 0.44377, 0.405874, 0.326957, -0.777303, -0.537494, 0.429647, -0.51798, -0.739662, -0.589639, 0.151579, -0.793316, 
	0.642883, -0.688116, 0.336448, 0.331394, 0.616392, 0.71431, 0.698995, 0.569192, 0.432928, -0.0157459, -0.532243, 0.846445, 
	-0.558808, -0.715779, 0.418801, -0.572858, 0.771123, -0.277855, 0.943534, -0.313204, 0.107921, -0.546987, 0.649, 0.528777, 
	-0.00279847, 0.216102, -0.976367, 0.261101, 0.708208, -0.655948, 0.487052, -0.438166, -0.755507, 0.170597, 0.292334, 0.940977, 
	-0.785177, -0.588154, 0.193834, -0.380907, 0.706295, 0.596705, 0.819267, -0.203721, -0.536003, -0.39294, 0.915678, -0.0844497, 
	-0.589249, -0.71174, -0.382377, 0.31537, 0.698175, 0.642723, 0.0472449, -0.230148, -0.972008, -0.0538147, 0.885015, 0.462441, 
	-0.471333, 0.591237, 0.654434, 0.573049, -0.0697521, 0.816547, -0.487083, 0.040398, 0.872421, -0.0095691, -0.680799, 0.732407, 
	0.284913, -0.911279, 0.297312, -0.00966498, -0.796978, 0.603931, 0.0793558, -0.810899, 0.579781, 0.470033, -0.882081, 0.0316728, 
	0.593043, 0.197014, -0.780696, -0.312277, 0.877523, -0.363917, 0.559585, -0.730566, 0.391329, 0.293709, -0.464235, 0.835596, 
	-0.0187249, 0.965495, -0.259746, -0.0647505, 0.954441, -0.291291, -0.5893, -0.149856, -0.793895, -0.572511, 0.301864, 0.762305, 
	-0.852829, -0.492113, -0.174664, 0.616188, 0.136584, 0.775665, 0.468835, 0.675005, 0.569704, -0.803418, -0.078067, 0.590276, 
	-0.0709505, 0.466373, -0.881738, 0.160767, -0.283037, 0.945539, -0.650823, -0.29939, 0.697707, -0.560683, 0.785246, 0.262723, 
	-0.360972, -0.259072, 0.895869, -0.454837, -0.748463, 0.482625, 0.21213, 0.865016, 0.454695, -0.479197, 0.14214, 0.866122, 
	0.739168, -0.664701, 0.108645, -0.472688, 0.8596, -0.194048, 0.725997, 0.26279, -0.635507, -0.413253, -0.636525, 0.651198, 
	-0.764228, 0.0193029, -0.644657, -0.781775, 0.366653, -0.504374, -0.675395, -0.622626, -0.395194, 0.15989, 0.0935367, -0.982693, 
	0.27824, -0.374633, 0.884439, -0.63476, 0.720519, 0.279162, 0.973171, -0.230012, 0.00574988, 0.473217, 0.702197, 0.531963, 
	-0.68144, 0.386521, 0.621483, -0.141326, 0.268367, -0.952894, -0.277505, -0.958811, 0.0605959, -0.346342, -0.203798, 0.915704, 
	-0.29039, -0.948232, 0.128567, -0.181371, 0.49186, 0.851574, 0.99634, 0.00161755, -0.0854608, -0.19757, 0.162658, -0.9667, 
	-0.0643906, 0.772958, 0.631181, 0.389876, 0.258687, 0.883786, -0.863357, -0.331053, 0.380812, 0.293165, -0.276383, 0.915241, 
	-0.0363768, -0.120558, -0.99204, -0.104533, 0.85426, 0.509227, -0.297083, -0.30292, 0.905528, -0.489226, -0.83755, -0.243242, 
	-0.420608, -0.885572, -0.197107, 0.130568, 0.63528, -0.761164, 0.921122, 0.0428589, -0.386907, -0.59011, -0.799384, -0.11294, 
	0.449707, -0.412419, -0.792259, 0.494775, 0.441464, 0.748536, 0.65131, 0.191214, -0.734325, 0.56612, 0.128409, 0.81426, 
	0.340918, 0.132992, -0.930638, 0.488804, -0.188001, 0.851896, -0.460044, -0.547877, -0.698706, -0.251859, 0.532152, -0.80832, 
	0.443694, 0.0145303, 0.896061, -0.869979, 0.188961, -0.455445, 0.15899, 0.967833, -0.194991, -0.184893, 0.533002, 0.825665, 
	-0.934565, -0.321607, -0.152178, -0.0116948, 0.264944, 0.964193, 0.205874, -0.849532, -0.485707, 0.643073, 0.323463, 0.694139, 
	-0.545062, -0.369815, 0.752425, -0.333741, -0.724874, -0.60264, 0.647024, -0.741859, -0.176085, 0.426671, 0.0562753, 0.902654, 
	0.933642, 0.349915, 0.0766313, 0.581517, -0.416975, -0.698549, -0.603976, -0.14077, 0.784472, 0.325581, -0.571504, 0.753247, 
	0.881606, -0.469596, -0.0474445, 0.505145, -0.492138, -0.708963, -0.422343, 0.202849, -0.883447, -0.748735, 0.0437672, 0.661423, 
	0.205234, 0.964793, 0.164481, -0.666449, 0.735784, 0.12028, -0.1828, -0.967344, 0.175582, -0.15803, 0.959476, 0.233309, 
	0.983293, 0.0679295, 0.168877, 0.621409, -0.334843, 0.70833, 0.693778, 0.720062, -0.0135174, 0.0956256, -0.973331, 0.208525, 
	-0.288928, 0.14299, -0.946612, 0.766418, -0.626058, 0.143716, 0.560523, -0.303612, -0.770476, 0.429702, -0.753053, 0.498264, 
	-0.618035, -0.663497, -0.421668, -0.833698, 0.428869, -0.347877, 0.558329, -0.322031, -0.764568, -0.581923, -0.796774, 0.162841, 
	0.503719, -0.848624, 0.161567, -0.768449, 0.155216, 0.620801, -0.988474, 0.151386, -0.00142366, -0.345284, -0.735496, -0.582945, 
	-0.160781, 0.485281, 0.859448, 0.0449131, -0.805957, 0.590268, -0.985132, -0.0373464, 0.167692, -0.33231, -0.869713, -0.364923, 
	-0.432612, 0.683653, -0.587763, 0.351864, -0.597794, -0.720301, -0.263441, 0.0583686, -0.962908, -0.0195527, -0.755864, -0.654436, 
	-0.182952, 0.564749, -0.804728, 0.82947, 0.166311, 0.533217, -0.497588, 0.647292, 0.577424, 0.302261, 0.923534, 0.236057, 
	-0.554533, -0.327717, -0.764915, -0.926606, 0.093116, 0.364323, -0.119265, -0.786607, -0.605826, -0.139334, -0.508917, -0.849464, 
	-0.601939, -0.761108, 0.241627, 0.226638, 0.201197, 0.952972, -0.300514, -0.56465, 0.768675, 0.173703, 0.98137, 0.0820991, 
	0.814546, -0.160399, 0.557482, -0.452825, -0.646194, 0.614314, 0.425172, -0.658932, 0.620514, 0.980226, -0.0458678, 0.192492, 
	0.778985, 0.597687, 0.189614, -0.714351, -0.681755, -0.157837, -0.775017, 0.434591, -0.45878, -0.893304, -0.395361, -0.213773, 
	-0.384422, -0.455402, 0.803012, -0.350776, 0.58157, -0.733984, 0.393762, 0.50302, 0.769365, 0.183435, -0.923834, 0.33598, 
	0.275241, 0.917347, -0.287607, 0.816175, -0.487685, -0.309875, -0.303844, 0.932357, 0.195933, 0.151959, -0.870863, 0.467446, 
	-0.989435, 0.0972198, -0.107547, -0.130958, 0.989432, 0.0622425, -0.169805, -0.90682, 0.385803, 0.998634, -0.0218007, -0.0474924, 
	0.225485, 0.974085, -0.0177349, 0.654171, 0.555148, -0.513684, 0.151346, -0.829748, 0.537227, 0.483579, 0.832216, -0.271233, 
	0.498354, 0.827411, 0.25891, 0.604866, -0.209666, -0.76823, -0.690779, 0.497411, 0.524791, -0.422832, 0.89954, -0.109734, 
	0.414866, 0.6057, 0.678981, 0.615691, 0.328149, 0.716409, 0.463669, 0.183921, 0.866709, 0.191013, -0.929355, -0.315932, 
	0.513038, 0.217923, 0.830242, -0.694829, -0.538247, -0.476973, 0.0962864, -0.670051, 0.736044, 0.391537, 0.785363, -0.479483, 
	0.320563, -0.946937, -0.0234483, -0.699572, 0.345468, -0.6255, 0.788678, 0.61435, -0.0236592, -0.263682, 0.131166, 0.95565, 
	-0.101113, 0.178356, -0.978757, 0.0758713, 0.984013, 0.161129, 0.175658, 0.312506, -0.933533, -0.0135876, -0.703324, 0.710739, 
	-0.398345, -0.739052, 0.543253, -0.985773, -0.156114, -0.0622847, -0.396112, -0.38941, -0.831538, -0.433612, -0.623761, 0.65031, 
	0.445608, -0.46273, 0.766364, -0.382026, -0.213538, 0.899143, -0.465081, -0.88163, 0.0801787, 0.948751, -0.255763, -0.185627, 
	0.87897, 0.209094, -0.428592, -0.801697, 0.0645779, -0.594233, 0.868595, 0.424106, 0.256275, 0.0959646, -0.917411, 0.386197, 
	-0.388926, 0.781119, 0.488457, 0.69142, 0.721735, -0.0322029, 0.423383, 0.400512, 0.812612, -0.95101, 0.0770975, -0.299394, 
	0.608655, -0.32532, 0.723675, 0.287765, 0.60964, -0.7386, -0.4621, -0.749991, -0.473262, 0.393993, -0.878753, 0.269376, 
	0.409851, 0.23559, -0.881204, 0.725704, 0.67983, 0.105756, 0.478457, 0.312026, 0.820804, 0.0707541, -0.961605, -0.265158, 
	0.810683, 0.556995, 0.180415, 0.170915, 0.843858, -0.508617, -0.574344, 0.790666, -0.212074, -0.306215, -0.252907, 0.917753, 
	-0.321199, 0.94395, 0.0760855, -0.80272, -0.226165, 0.551806, 0.880934, -0.446427, 0.157032, 0.941722, -0.25032, -0.224719, 
	0.684258, 0.384451, 0.619669, 0.78884, -0.185207, 0.586029, 0.545845, -0.768066, 0.334854, -0.283708, -0.778107, -0.56041, 
	0.488379, -0.503051, -0.713039, 0.189447, 0.231671, -0.954169, -0.227749, -0.740192, -0.63265, 0.981145, 0.0402535, 0.189035, 
	0.36229, 0.492784, -0.791145, -0.864337, -0.200315, -0.461298, -0.163647, -0.14142, 0.97633, -0.60164, 0.587117, -0.541592, 
	-0.527836, 0.206853, -0.823773, -0.813988, 0.55463, -0.172651, -0.036061, 0.870228, -0.491328, -0.847284, -0.506289, -0.160568, 
	-0.395458, 0.842231, -0.366416, 0.299131, -0.939245, -0.168344, 0.614716, -0.788747, 0.00175315, -0.105233, -0.366086, -0.924612, 
	-0.606748, 0.412384, 0.679556, -0.83748, -0.398657, -0.373765, 0.448053, 0.884968, 0.126807, 0.734721, 0.673141, 0.0840635, 
	-0.668354, 0.740917, 0.0659151, -0.567102, 0.610641, -0.552732, -0.954969, -0.191629, 0.226524, -0.396469, 0.0247577, 0.917714, 
	0.524555, -0.318086, -0.789723, -0.634523, -0.707181, -0.31189, 0.165749, -0.670102, -0.723526, 0.136075, -0.595982, 0.791384, 
	0.207227, -0.53049, -0.821972, -0.35233, -0.287882, 0.890499, -0.214467, 0.284345, 0.934426, -0.169971, 0.981914, 0.0833939, 
	0.457962, -0.551189, 0.697468, -0.460771, 0.851703, -0.249583, 0.367574, 0.788963, -0.492369, -0.939785, -0.103942, 0.325576, 
	0.869395, -0.471557, 0.147598, -0.334798, -0.371895, -0.865797, 0.170594, -0.983723, -0.0564547, -0.673621, 0.712359, 0.196925, 
	0.70178, -0.566006, -0.432599, 0.584274, 0.810119, 0.0482799, 0.374469, 0.917213, -0.135989, 0.887011, -0.0669576, -0.456869, 
	-0.129721, -0.746672, 0.652422, -0.361125, 0.873428, -0.326668, 0.887275, 0.0677965, -0.456231, 0.3455, -0.693499, -0.63221, 
	-0.543341, 0.37155, 0.752815, -0.385949, 0.628038, -0.675731, -0.778581, 0.620839, -0.0914896, -0.70037, -0.690251, -0.181758, 
	0.489775, -0.0499555, 0.870417, -0.0312048, 0.868806, 0.494169, 0.832968, 0.119592, 0.540243, -0.907205, 0.366203, 0.207059, 
	-0.904003, -0.270581, -0.331005, 0.418896, -0.389825, 0.820099, 0.641375, 0.698081, -0.318311, -0.0792172, -0.0640777, -0.994796, 
	0.113072, 0.840336, -0.530142, 0.473615, -0.876176, 0.089466, -0.971706, -0.0518893, 0.230424, 0.132495, -0.977139, -0.166264, 
	0.230594, 0.941186, 0.246971, -0.958776, -0.114601, 0.26003, -0.961818, 0.0865078, -0.259658, 0.556965, -0.640782, -0.528383, 
	-0.132421, -0.921836, -0.364256, 0.470317, 0.684761, -0.55669, 0.8355, -0.358107, 0.416772, 0.7193, 0.679133, -0.146237, 
	0.382276, 0.125719, 0.915456, -0.0539488, -0.993039, -0.104701, -0.11506, 0.478829, -0.870335, 0.897661, 0.433751, 0.0778788, 
	-0.271454, -0.00664761, -0.962428, 0.854503, 0.517757, 0.0418616, -0.797629, -0.0653809, -0.599595, -0.891013, -0.240683, 0.384925, 
	-0.772721, 0.217146, 0.596448, 0.232445, -0.858427, 0.457245, 0.570375, 0.571584, -0.589885, -0.548417, -0.815373, 0.185487, 
	-0.444631, 0.882871, -0.151137, -0.00469093, 0.992727, -0.120295, 0.332496, 0.942925, -0.0184135, 0.511735, -0.858083, 0.042685, 
	-0.625871, -0.319283, 0.711578, -0.317307, -0.489988, -0.811929, -0.386414, 0.683023, 0.61981, 0.279919, -0.899622, -0.335151, 
	-0.136818, -0.644744, 0.752055, 0.828164, 0.0380263, -0.559195, -0.293939, -0.791475, -0.53588, -0.93689, -0.343859, -0.0632296, 
	-0.200032, 0.563156, -0.801775, 0.861479, 0.479046, -0.168431, 0.730387, -0.0521534, -0.681039, -0.424969, 0.223359, 0.877219, 
	0.370736, -0.13103, 0.919449, -0.941169, 0.177084, -0.287824, -0.918143, 0.174245, -0.355882, 0.945854, 0.032408, -0.32297, 
	-0.230904, 0.854091, 0.466059, -0.74862, -0.254709, 0.61212, 0.758771, -0.344552, 0.552766, 0.180603, 0.710093, 0.680552, 
	0.970229, 0.240405, 0.0293303, -0.981209, -0.0399323, 0.18877, -0.0789764, -0.563677, 0.822211, 0.0634933, 0.785705, -0.615335, 
	0.768692, -0.343611, -0.539485, -0.348854, 0.896153, 0.274247, -0.0351515, -0.991698, -0.123689, -0.76323, -0.46972, 0.44367, 
	0.091155, -0.962834, 0.254247, -0.0618455, -0.5199, 0.851985, -0.881049, 0.429853, -0.197433, 0.890198, 0.308091, -0.335601, 
	-0.633677, 0.654814, -0.411912, -0.554516, 0.829925, 0.0611293, 0.0565124, -0.749065, -0.660081, -0.126916, -0.991616, 0.0242862, 
	-0.596138, -0.754966, 0.273215, -0.97894, -0.0602149, 0.195065, -0.203345, 0.972512, -0.11345, 0.932748, 0.0285809, -0.359395, 
	-0.614057, -0.0426389, 0.788109, -0.753109, 0.587723, -0.295648, 0.788459, 0.350467, -0.505475, -0.892217, -0.400322, -0.209023, 
	0.640167, -0.209843, -0.739021, 0.581142, -0.15761, -0.798394, -0.00993811, -0.495905, 0.86832, -0.323067, 0.236696, 0.916298, 
	0.852085, -0.0504838, -0.520962, 0.799443, -0.222464, -0.558033, -0.789025, 0.0286098, -0.613695, 0.138455, -0.780974, 0.609024, 
	-0.133291, -0.443996, 0.886059, 0.715381, -0.2853, -0.637836, 0.339977, 0.070015, -0.937824, -0.194307, 0.900606, -0.388786, 
	0.202216, 0.784458, 0.586289, -0.0933347, 0.995435, 0.0199639, -0.574212, -0.58972, 0.567901, 0.247016, -0.954783, -0.165447, 
	-0.328294, -0.669525, -0.666303, 0.670475, 0.336823, 0.66107, 0.546046, 0.379728, -0.746753, -0.92064, 0.199747, 0.335446, 
	-0.367022, 0.808398, -0.460204, -0.279304, 0.682737, 0.675174, 0.134017, -0.408118, -0.903039, 0.137668, -0.730972, -0.668377, 
	-0.532873, 0.442162, -0.721484, -0.169609, -0.898219, -0.405506, -0.393057, -0.533736, 0.748754, -0.97853, 0.0349748, 0.203115, 
	0.279239, 0.922304, 0.267171, 0.259912, -0.424816, -0.867166, 0.71837, 0.497431, -0.486321, -0.387856, -0.751884, -0.53314, 
	0.737837, 0.666257, -0.108158, 0.529477, -0.0192451, -0.848106, 0.455921, 0.611801, -0.646402, -0.251458, -0.50841, 0.823582, 
	-0.578706, -0.0794014, -0.811662, -0.442261, 0.826412, -0.348496, -0.285117, 0.390229, 0.87546, 0.258276, 0.369772, -0.892503, 
	0.363147, -0.369394, 0.855378, 0.0591016, -0.58795, 0.806735, 0.252608, -0.728334, -0.636961, 0.882119, 0.351408, 0.313655, 
	-0.326919, -0.556983, -0.763475, 0.30637, 0.0629393, 0.949829, 0.408532, 0.547171, 0.730551, -0.572505, -0.719961, -0.392293, 
	-0.873147, 0.350998, 0.338253, -0.48706, -0.669428, 0.560926, -0.809152, -0.405661, -0.425102, -0.672442, 0.216473, -0.707786, 
	0.186127, -0.967003, -0.17396, 0.880951, -0.381281, 0.280267, 0.215181, -0.455411, -0.863885, -0.24198, 0.490926, 0.836921, 
	-0.0976704, 0.178665, -0.97905, 0.43259, 0.0203545, 0.901361, 0.35994, 0.618801, -0.698232, -0.404234, 0.29845, 0.864594, 
	0.0425695, -0.44747, 0.893285, 0.130234, -0.768004, -0.627064, -0.737374, 0.237535, 0.632343, 0.392099, 0.358896, -0.847025, 
	0.403101, -0.912134, 0.0743058, 0.564921, -0.161455, 0.809195, 0.902802, 0.272826, 0.332437, 0.177014, 0.742943, 0.645525, 
	-0.0393973, 0.508541, 0.860136, 0.840541, 0.258416, 0.476143, 0.681408, -0.67741, 0.277127, -0.215338, -0.792177, -0.571039, 
	0.515218, -0.266399, -0.814605, -0.621014, 0.753244, -0.216714, -0.175045, 0.102081, 0.979254, 0.61191, -0.245647, 0.751814, 
	-0.363936, -0.666591, 0.650544, 0.946866, -0.0606514, 0.315857, -0.397143, -0.834583, -0.38177, -0.192758, -0.0242474, -0.980947, 
	-0.757927, 0.398452, 0.516511, 0.497374, -0.844087, -0.200338, 0.0865855, 0.995784, 0.0302758, -0.723584, 0.658179, -0.20791, 
	0.61189, 0.72851, -0.308, -0.831192, -0.540009, 0.132328, 0.246553, 0.665489, 0.704511, -0.10256, -0.971723, -0.212689, 
	0.330818, -0.571367, 0.751065, -0.00133241, -0.767448, -0.64111, 0.130626, 0.591501, 0.795653, 0.391437, 0.265859, 0.880963, 
	-0.923929, -0.371983, -0.0893475, -0.789825, -0.516571, -0.330652, -0.994858, -0.0345461, 0.0952049, -0.150182, 0.98335, 0.102313, 
	-0.306449, 0.146202, -0.940593, 0.197182, 0.802074, -0.563734, 0.14245, -0.336233, -0.930943, -0.681111, 0.633655, -0.366837, 
	-0.832856, -0.486839, -0.263321, -0.548404, 0.0444431, -0.835032, -0.517062, 0.185932, 0.83551, 0.238185, -0.518812, 0.821037, 
	0.0701237, 0.4838, -0.872365, 0.728914, 0.498389, -0.469353, 0.0283956, 0.541698, -0.840094, -0.259323, 0.951759, 0.164035, 
	-0.792131, -0.604775, 0.0823107, -0.763819, -0.0545314, -0.643123, -0.714825, -0.515346, 0.472698, 0.215534, -0.697122, -0.683788, 
	0.476532, 0.0150814, -0.879028, 0.926336, 0.0395798, -0.374614, -0.952028, 0.273676, -0.136906, -0.271846, -0.295521, -0.915842, 
	0.110725, -0.914474, 0.3892, -0.480612, -0.704287, -0.522487, -0.109319, 0.331651, -0.937047, -0.628875, 0.537519, -0.561774, 
	-0.184798, 0.941433, -0.282054, -0.409299, 0.886898, 0.214213, 0.446132, 0.75568, 0.479494, 0.830059, -0.251555, -0.497717, 
	0.80578, -0.136914, 0.576171, -0.365241, -0.58279, -0.725917, -0.355093, -0.400398, -0.844743, -0.89387, -0.0911062, -0.438972, 
	-0.449233, 0.888111, 0.0972084, 0.603946, 0.74795, 0.275355, 0.286494, -0.514605, 0.808148, -0.268051, -0.101252, -0.958069, 
	0.232149, -0.263296, -0.936366, 0.21265, 0.024155, 0.97683, -0.893997, 0.402256, -0.197379, 0.538079, -0.647092, 0.540132, 
	0.515211, 0.853846, -0.0741869, -0.399938, 0.597211, -0.695262, -0.290715, -0.450783, -0.843967, -0.981432, 0.000257539, -0.19181, 
	0.328462, -0.519641, 0.788724, 0.730799, -0.146007, -0.666795, -0.161712, 0.819443, 0.549874, 0.565659, -0.783535, -0.257104, 
	-0.741196, -0.296604, -0.602208, -0.683777, -0.176849, -0.707936, -0.729029, -0.60585, 0.318531, -0.798171, -0.437559, 0.414083, 
	0.530555, 0.150123, -0.834251, -0.90339, -0.00791072, -0.428748, -0.833086, -0.0655956, -0.54924, -0.143303, -0.223207, -0.96418, 
	0.534167, 0.156392, -0.830787, 0.576609, 0.38465, 0.720809, -0.721748, 0.564131, -0.401043, -0.598012, 0.801202, -0.0213853, 
	-0.698845, 0.703154, 0.131111, -0.502497, 0.654641, -0.564749, 0.0810799, 0.334493, -0.938904, 0.121359, 0.621683, 0.773811, 
	0.674582, -0.602843, 0.426051, 0.591512, 0.558642, 0.581406, -0.586939, 0.119612, 0.800747, 0.720553, 0.684275, 0.112122, 
	-0.98553, 0.136972, 0.0998505, 0.54213, 0.0716513, -0.837234, 0.214165, 0.877783, 0.428521, 0.270448, 0.947512, -0.170528, 
	0.429675, 0.314108, 0.846591, -0.930149, 0.089487, 0.35611, 0.942869, 0.253043, 0.216719, 0.337795, -0.148331, 0.929458, 
	0.00496326, -0.999962, 0.00714856, -0.0630589, -0.85729, -0.510958, 0.358238, 0.252936, -0.898715, 0.853101, 0.280246, -0.440092, 
	-0.784289, 0.168653, 0.597032, 0.34726, -0.936647, 0.0458525, 0.673514, 0.342666, 0.654949, -0.235549, -0.16744, -0.95733, 
	-0.366208, 0.584086, -0.724386, -0.938835, -0.0211821, -0.343716, 0.132689, 0.472536, -0.871265, 0.876085, -0.450696, -0.17131, 
	-0.931821, -0.0113732, 0.362739, -0.937701, 0.323101, 0.127762, -0.119648, 0.800618, -0.587107, -0.454727, -0.775471, -0.438027, 
	0.631016, 0.755897, -0.174465, 0.765591, 0.23949, -0.597089, -0.267558, -0.231716, -0.935265, 0.0068216, -0.103273, -0.99463, 
	-0.718834, 0.0970157, -0.688379, -0.908194, -0.115294, -0.402356, 0.767382, 0.57182, 0.290081, -0.923026, 0.371476, 0.100145, 
	0.298458, -0.950075, 0.090996, 0.184798, -0.205188, 0.961118, 0.515355, 0.856013, -0.0406334, 0.0992657, 0.993428, -0.0569751, 
	-0.417984, 0.233107, -0.878038, 0.783191, -0.618508, -0.063713, 0.0834519, -0.908513, -0.409439, 0.613036, -0.12038, 0.78083, 
	-0.029415, -0.118411, 0.992529, 0.120868, 0.372372, -0.920179, -0.697269, 0.329323, -0.63668, 0.151568, -0.988375, 0.0119389, 
	0.830441, 0.556386, -0.0283185, 0.208082, 0.458171, -0.864165, 0.168634, 0.97888, 0.115573, 0.90164, 0.379842, 0.206796, 
	0.982848, 0.180463, -0.0379801, 0.134088, 0.0310833, 0.990482, 0.024432, -0.74402, -0.66771, -0.348355, -0.130588, -0.928222, 
	0.83271, 0.13934, 0.53589, 0.019299, -0.948778, -0.315354, 0.223566, 0.506038, -0.833033, -0.105458, 0.85642, -0.505394, 
	-0.240855, -0.305511, 0.921223, 0.667786, 0.609952, 0.426638, 0.18201, 0.892443, 0.412818, -0.858269, -0.0700825, -0.508392, 
	-0.993883, 0.110091, -0.00871593, -0.161448, -0.80443, 0.571688, 0.658142, 0.527762, 0.536951, 0.753537, -0.605899, 0.255086, 
	0.284405, 0.913772, 0.290061, 0.849297, -0.381996, -0.364381, -0.530078, -0.773711, -0.34697, -0.396173, 0.908521, 0.132804, 
	-0.998866, 0.0467883, 0.00882536, 0.655223, -0.248317, -0.713458, 0.243512, 0.810965, 0.532013, 0.79219, -0.0759421, 0.605531, 
	0.0319114, 0.0234741, -0.999215, -0.13026, -0.751419, -0.64684, -0.467862, -0.64235, 0.607036, -0.748552, 0.563466, 0.349537, 
	0.277251, -0.570915, 0.77278, 0.94501, 0.269015, -0.185975, -0.906979, 0.419105, -0.0417245, -0.317871, 0.446994, -0.836154, 
	-0.874384, 0.0610754, 0.481376, -0.572168, 0.08133, 0.816094, -0.721197, -0.168552, -0.671912, 0.913778, -0.405967, 0.0141706, 
	0.311849, -0.0182328, 0.949957, -0.581761, 0.492395, 0.64738, -0.994178, 0.0172786, 0.106359, -0.230337, -0.0564529, -0.971472, 
	-0.0470156, 0.753696, 0.65554, 0.900053, -0.362704, -0.241556, -0.749482, 0.556663, 0.358334, 0.512407, -0.691909, -0.508626, 
	-0.161256, 0.946065, -0.280992, 0.548596, 0.331037, 0.767761, 0.40404, -0.469482, 0.785072, 0.606147, -0.776957, -0.170066, 
	0.918528, 0.391183, -0.0572891, -0.758077, -0.493317, 0.426565, 0.596721, 0.269986, 0.755666, 0.440634, -0.822588, -0.359431, 
	-0.219294, -0.612203, 0.759682, 0.940662, 0.0493432, -0.33574, -0.0906586, -0.952971, 0.289184, -0.557313, 0.760086, -0.334172, 
	-0.180583, 0.665872, -0.723881, -0.356872, -0.822522, -0.442831, 0.677385, 0.732493, 0.0678448, -0.264397, 0.948171, -0.176259, 
	0.961073, 0.126751, 0.245504, 0.07801, -0.740457, -0.667561, 0.733163, 0.358919, -0.577624, 0.268101, -0.478567, -0.83612, 
	0.826611, 0.556799, 0.0817891, 0.285385, 0.877197, 0.38611, 0.829791, -0.43501, 0.349589, -0.89043, 0.444664, -0.097002, 
	0.081797, -0.521792, 0.849142, -0.132837, -0.957306, 0.256748, -0.729148, -0.457334, -0.509105, 0.470087, -0.668387, -0.576435, 
	-0.646755, 0.709438, 0.280011, 0.565191, -0.509427, 0.648879, -0.977786, -0.148495, 0.147928, 0.562336, 0.78857, 0.248869, 
	0.134309, 0.959576, -0.247334, 0.813844, 0.0216879, -0.580679, -0.0804723, -0.956015, 0.282063, -0.307867, -0.949372, 0.0625437, 
	0.0377703, -0.953656, 0.29852, 0.133615, 0.796724, 0.589388, 0.124788, -0.847826, 0.515383, 0.579817, 0.765762, -0.278247, 
	-0.635083, 0.45448, 0.624594, -0.925809, 0.198855, 0.321456, -0.122282, -0.986306, 0.11067, -0.571879, 0.205903, -0.794077, 
	-0.197413, -0.30727, -0.930921, -0.325483, 0.0882655, 0.941419, -0.000116172, 0.0201606, -0.999797, 0.515754, -0.793236, -0.323689, 
	0.845586, 0.396767, -0.357155, -0.0542768, -0.333644, 0.941135, -0.962917, -0.145166, -0.227415, 0.621782, -0.559137, -0.54841, 
	0.193667, 0.981007, 0.0108798, -0.283432, -0.159057, 0.94571, -0.235389, 0.910321, -0.340451, -0.851755, 0.523868, -0.00874859, 
	-0.000953395, -0.857758, -0.514053, 0.590858, 0.772016, -0.234259, 0.400247, -0.723969, 0.561846, -0.905342, -0.417084, -0.0799862, 
	-0.165339, 0.265133, -0.94993, -0.46006, 0.818088, 0.345075, 0.272665, -0.0341223, -0.961504, 0.0453685, -0.18368, -0.981938, 
	-0.1537, -0.725025, -0.671353, 0.556888, -0.803628, -0.209899, 0.746108, 0.599967, 0.288727, 0.327787, -0.918647, 0.220554, 
	-0.428039, -0.662808, 0.614384, 0.246399, 0.735003, -0.63171, 0.587524, 0.787505, 0.186148, -0.565276, -0.732957, -0.378466, 
	0.531515, -0.035681, 0.846297, -0.324104, -0.80133, 0.502819, -0.60363, -0.262015, -0.75298, -0.562915, -0.678165, 0.472461, 
	-0.821222, -0.43664, -0.367343, -0.573656, 0.306995, 0.75939, -0.557574, 0.511048, 0.654172, -0.475163, 0.287907, -0.831462, 
	-0.528886, 0.820787, 0.21584, -0.254652, 0.960205, -0.114706, 0.512503, 0.823196, 0.244313, 0.511966, -0.474397, -0.716128, 
	0.0526037, 0.876586, -0.478361, 0.96941, -0.044519, -0.241374, 0.86307, 0.0766125, 0.49924, -0.0886286, 0.876087, -0.473938, 
	-0.258445, 0.959466, 0.112388, 0.897247, 0.105194, 0.428815, -0.648789, -0.499416, 0.574157, 0.849903, 0.473086, -0.232066, 
	-0.932265, -0.291105, 0.2148, -0.565987, -0.81856, 0.0980687, 0.648995, 0.712067, 0.267893, 0.190988, 0.219011, -0.956848, 
	0.718475, 0.632079, -0.290293, 0.476529, -0.0514849, -0.87765, -0.604835, 0.795296, 0.0409645, -0.859738, -0.225657, -0.45818, 
	0.611313, 0.779621, 0.135971, 0.776083, -0.630324, 0.0196787, -0.148455, -0.063775, -0.986861, -0.251332, -0.761239, 0.597786, 
	0.352963, -0.638266, 0.68413, 0.793912, 0.280171, -0.539637, -0.239056, -0.21746, 0.946342, -0.267467, 0.642121, 0.71843, 
	-0.863784, 0.458201, 0.20959, 0.915577, -0.304136, 0.263096, 0.780525, -0.56022, 0.277371, -0.659579, 0.600941, -0.45147, 
	0.153482, 0.596383, -0.78789, 0.453489, -0.674917, -0.582096, -0.62111, 0.778531, 0.0900646, 0.292526, 0.951568, -0.0945839, 
	-0.96871, -0.207056, -0.13685, 0.386162, -0.920428, 0.0607583, -0.975435, 0.181004, 0.125559, -0.636339, 0.731975, -0.243486, 
	0.167855, -0.985347, -0.0302653, -0.157627, -0.845122, -0.510806, -0.10895, 0.620111, 0.776912, 0.0501222, -0.97436, 0.219341, 
	-0.139575, 0.144281, -0.979644, 0.0812625, 0.534737, -0.841102, -0.280278, 0.336053, -0.899173, -0.818062, -0.397616, -0.415543, 
	0.303329, -0.943251, 0.135166, 0.203548, -0.715705, 0.668082, 0.333305, -0.503466, 0.797139, -0.155752, 0.673468, -0.722622, 
	-0.857868, -0.502815, 0.106016, -0.428931, -0.879215, -0.207361, -0.792563, 0.557783, 0.246418, -0.398307, -0.911847, -0.099431, 
	-0.254393, 0.743315, -0.618682, 0.822667, -0.361515, 0.438778, -0.0477523, 0.885788, 0.461627, 0.313095, -0.500587, -0.807084, 
	-0.907809, -0.415912, 0.0538445, -0.611333, 0.377978, 0.695273, 0.202242, 0.447041, -0.871351, 0.70255, 0.709017, 0.0609763, 
	0.935704, 0.332882, -0.11682, 0.0244562, -0.617616, 0.786099, -0.819346, 0.0725665, 0.568689, 0.167498, 0.801473, 0.574095, 
	-0.941765, 0.180047, 0.28401, -0.388393, 0.236957, -0.890507, 0.956293, 0.19458, -0.218269, 0.878755, 0.472774, -0.0653781, 
	-0.836498, -0.44639, 0.317815, -0.698156, -0.68575, 0.205729, 0.10658, 0.900936, 0.420661, 0.838129, -0.126327, 0.530643, 
	0.279362, 0.635567, 0.71973, -0.563154, 0.288898, 0.774207, 0.614783, 0.150645, 0.774176, -0.97589, 0.186236, -0.113823, 
	0.609203, 0.780901, -0.138079, -0.539904, -0.777435, -0.322642, 0.945046, -0.265533, -0.190737, -0.630991, 0.366731, 0.683637, 
	-0.625342, 0.75162, -0.209794, 0.917116, -0.392497, -0.069604, 0.503132, 0.102616, -0.858096, 0.627482, -0.104078, 0.771644, 
	0.17099, -0.966515, 0.191341, -0.185485, -0.691275, 0.69838, 0.198147, -0.220231, -0.95511, -0.437657, -0.284206, -0.853044, 
	-0.702679, 0.574052, 0.420364, 0.271528, 0.672339, -0.688645, -0.720275, -0.532242, 0.444885, 0.991548, 0.123528, -0.0396664, 
	0.0221477, 0.853337, -0.520889, -0.543652, 0.370262, -0.753225, 0.341025, -0.173532, 0.923899, -0.295205, 0.797732, 0.525811, 
	-0.897196, 0.440375, 0.0333027, 0.457971, 0.875196, 0.155868, 0.60899, 0.313582, 0.728559, 0.171096, -0.708958, -0.684182, 
	0.825964, 0.393898, 0.403271, 0.761868, 0.623386, -0.175914, 0.343283, -0.56461, 0.750581, 0.772884, 0.632122, -0.0554243, 
	-0.539971, 0.626563, 0.562005, -0.685934, -0.699663, 0.199914, -0.810349, -0.215608, 0.544837, 0.17201, 0.56634, -0.806022, 
	-0.977446, -0.158944, 0.139055, 0.732186, -0.331699, -0.594878, 0.865863, 0.382858, 0.322027, -0.0414618, 0.116955, -0.992271, 
	0.498326, -0.756537, 0.423465, 0.92086, 0.233682, -0.312106, 0.15909, -0.276664, 0.947706, 0.828607, -0.306621, 0.468396, 
	-0.634225, -0.684293, 0.359864, -0.016946, -0.85545, -0.517608, 0.398283, -0.915158, -0.0621107, 0.929699, -0.325526, -0.172317, 
	-0.0831261, 0.829441, 0.552375, -0.430512, -0.631927, -0.644459, -0.838928, -0.1729, -0.516049, -0.806218, 0.322968, 0.495686, 
	0.351986, 0.558646, -0.751013, 0.513724, 0.856609, 0.0480389, 0.872953, 0.26782, 0.407709, 0.117174, -0.195139, -0.973751, 
	0.171806, -0.913254, 0.369391, -0.869443, 0.214451, 0.445061, 0.96757, -0.147086, 0.205362, 0.333475, -0.382773, -0.861556, 
	-0.573127, -0.629364, -0.524811, -0.872822, -0.262341, -0.411533, -0.205733, 0.0373579, -0.977895, -0.939356, -0.181861, -0.290751, 
	-0.173428, 0.963749, -0.202757, 0.226101, 0.694873, 0.682664, 0.0337228, 0.941029, -0.336641, 0.390814, 0.515163, 0.762805, 
	-0.412731, 0.884477, 0.217607, 0.406098, 0.0335492, -0.913213, -0.873507, -0.257647, -0.413043, -0.389807, 0.765769, -0.511517, 
	-0.571967, 0.370296, -0.731939, -0.608006, 0.727411, 0.318123, 0.189851, 0.37461, 0.907537, 0.956412, -0.178492, 0.23112, 
	0.0227649, 0.522542, -0.852309, -0.893807, 0.446629, 0.0403894, -0.909197, 0.112278, 0.400941, -0.154551, 0.857891, 0.490038, 
	-0.871223, -0.389253, -0.299086, 0.39966, 0.912694, 0.085219, -0.512383, 0.693462, -0.506531, 0.0101659, -0.406315, 0.913677, 
	0.404281, 0.799723, 0.443847, -0.74788, 0.500539, 0.436046, 0.107616, 0.957326, 0.268227, 0.25916, 0.681107, -0.684784, 
	0.689802, -0.492564, 0.530616, -0.340306, -0.531348, -0.775797, 0.670277, 0.514435, -0.53487, -0.306806, -0.683988, 0.661838, 
	-0.408653, -0.468717, 0.78314, -0.247336, 0.610567, 0.752351, -0.872984, -0.0488699, 0.485294, -0.283895, -0.251524, -0.925278, 
	-0.334842, 0.884099, -0.325961, -0.83602, -0.144111, -0.529437, -0.773924, -0.107419, -0.624102, -0.420472, -0.89391, -0.155329, 
	0.605762, -0.449849, -0.656269, -0.0831337, 0.996506, -0.00805611, 0.0771422, -0.514333, 0.854114, 0.496993, -0.624442, -0.602553, 
	-0.823016, 0.365584, -0.434733, -0.0672596, 0.361784, -0.929832, -0.882852, 0.378319, 0.278294, -0.660025, 0.334741, -0.672544, 
	0.972742, -0.103876, -0.207325, 0.662011, 0.650825, -0.371709, 0.0964981, 0.941559, -0.32273, 0.901369, -0.207362, 0.380178, 
	-0.23086, -0.425185, -0.875169, 0.38294, 0.542073, 0.748007, -0.878322, 0.391373, -0.274549, -0.507838, 0.72401, 0.466808, 
	-0.503385, -0.806222, 0.310821, -0.938179, -0.0462431, -0.343048, 0.549692, -0.79879, -0.244485, -0.0384476, -0.765909, 0.641798, 
	0.476526, 0.850357, -0.223195, 0.624396, 0.740904, -0.247368, 0.536835, -0.808505, -0.241098, -0.361394, -0.340943, -0.867844, 
	-0.871481, 0.24514, -0.424768, 0.164412, -0.803155, 0.572635, -0.417171, 0.823556, 0.384349, -0.0288543, -0.714366, -0.699177, 
	0.387838, -0.738029, -0.552173, 0.976072, -0.121309, -0.180466, 0.00323573, -0.341604, 0.939839, 0.442022, 0.839417, -0.316221, 
	-0.416578, -0.493361, 0.763582, 0.701807, 0.289634, -0.65083, 0.556644, 0.545637, -0.626441, -0.125099, 0.991599, -0.0328987, 
	-0.198301, 0.798383, 0.56856, 0.300468, 0.499161, -0.812747, 0.949536, -0.0442048, 0.310527, -0.059327, -0.143064, 0.987934, 
	0.124528, 0.883435, -0.451703, 0.205686, 0.835105, -0.51019, -0.185385, 0.0552978, -0.981109, -0.476121, 0.465273, 0.74621, 
	0.94931, -0.30807, 0.0624686, 0.730721, -0.338247, 0.59299, 0.478178, 0.666039, -0.572483, -0.779578, -0.476789, 0.406117, 
	0.994366, -0.0211117, 0.103877, 0.138489, -0.196949, 0.970583, -0.157165, 0.980418, 0.118656, 0.623251, -0.735281, 0.266308, 
	0.732764, -0.195661, -0.651746, -0.105237, 0.675466, -0.729843, -0.877189, -0.339359, 0.339669, 0.932943, 0.298342, -0.201518, 
	-0.449444, 0.0905463, -0.888708, -0.466002, 0.836379, 0.288637, -0.25685, 0.966181, -0.0228555, -0.196308, 0.908767, -0.368248, 
	0.227609, 0.90364, 0.362807, 0.220573, -0.103436, 0.96987, -0.307347, 0.861793, -0.403548, 0.88575, 0.0254857, -0.463463, 
	0.824537, -0.502236, -0.260572, 0.183417, -0.88447, 0.429035, 0.900913, -0.174651, 0.397306, 0.835928, -0.314277, 0.44995, 
	-0.528045, 0.703007, -0.476391, -0.785559, 0.613898, -0.0776293, 0.208019, 0.945792, 0.249412, 0.610646, 0.633031, 0.475797, 
	-0.552867, 0.763223, -0.334407, 0.44402, 0.19289, 0.875008, -0.940172, -0.0920034, -0.328042, 0.407579, -0.338883, 0.847961, 
	0.179149, -0.954827, -0.237089, 0.400866, -0.296557, 0.86681, 0.72717, -0.669807, -0.150272, 0.594824, -0.803548, -0.0222413 };

typedef float real;

using namespace std;

const real noise_domain_scale = icarus::pi;

inline real
glattice( long ix, real fx, const unsigned short *perm )
{
	const float *g = &table[ perm[ ix & 1023 ] * 3 ];
	return g[ 0 ] * fx;
}

inline real
glattice( long ix, long iy, real fx, real fy, const unsigned short *perm )
{
	const float *g = &table[ perm[ ( ix + perm[ iy & 1023 ] ) & 1023 ] * 3 ];
	return g[ 0 ] * fx + g[ 1 ] * fy;
}

inline real
glattice( long ix, long iy, long iz, real fx, real fy, real fz, const unsigned short *perm )
{
	const float *g = &table[ perm[ ( ix + perm[ ( iy + perm[ iz & 1023 ] ) & 1023 ] ) & 1023 ] * 3 ];
	return g[ 0 ] * fx + g[ 1 ] * fy + g[ 2 ] * fz;
}

inline real
_lerp( real t, real x0, real x1 )
{
	return x0 + t * ( x1 - x0 );
}

real
_gradient_noise( real x, const unsigned short *perm )
{
	x *= noise_domain_scale;

	long ix;
	real h, c_1 = 1, c_3 = 3;
	real fx0, fx1;
	real wx;
	real vx0, vx1;

	h = floor( x );
	ix = h;
	fx0 = x - h;
	fx1 = fx0 - c_1;
	wx = fx0 * fx0 * ( c_3 - ( fx0 + fx0 ) );

	vx0 = glattice( ix, fx0, perm );
	vx1 = glattice( ix + 1, fx1, perm );
  
    return _lerp( wx, vx0, vx1 );
}

real
_gradient_noise( real x, real y, const unsigned short *perm )
{
	x *= noise_domain_scale;
	y *= noise_domain_scale;

	long ix, iy;
	real h, c_1 = 1, c_3 = 3;
	real fx0, fx1, fy0, fy1;
	real wx, wy;
	real vx0, vx1, vy0, vy1;

	h = floor( x );
	ix = h;
	fx0 = x - h;
	fx1 = fx0 - c_1;
	wx = fx0 * fx0 * ( c_3 - ( fx0 + fx0 ) );

	h = floor( y );
	iy = h;
	fy0 = y - h;
	fy1 = fy0 - c_1;
	wy = fy0 * fy0 * ( c_3 - ( fy0 + fy0 ) );

	vx0 = glattice( ix, iy, fx0, fy0, perm );
    vx1 = glattice( ix + 1, iy, fx1, fy0, perm );
    vy0 = _lerp( wx, vx0, vx1 );
    vx0 = glattice( ix,iy + 1, fx0, fy1, perm );
    vx1 = glattice( ix + 1, iy + 1, fx1, fy1, perm );
    vy1 = _lerp( wx, vx0, vx1 );
    
    return _lerp( wy, vy0, vy1 );
}

real
_gradient_noise( real x, real y, real z, const unsigned short *perm )
{
	x *= noise_domain_scale;
	y *= noise_domain_scale;
	z *= noise_domain_scale;

	long ix, iy, iz;
	real h, c_1 = 1, c_3 = 3;
	real fx0, fx1, fy0, fy1, fz0, fz1;
	real wx, wy, wz;
	real vx0, vx1, vy0, vy1, vz0, vz1;

	h = floor( x );
	ix = h;
	fx0 = x - h;
	fx1 = fx0 - c_1;
	wx = fx0 * fx0 * ( c_3 - ( fx0 + fx0 ) );

	h = floor( y );
	iy = h;
	fy0 = y - h;
	fy1 = fy0 - c_1;
	wy = fy0 * fy0 * ( c_3 - ( fy0 + fy0 ) );

	h = floor( z );
	iz = h;
	fz0 = z - iz;
	fz1 = fz0 - c_1;
	wz = fz0 * fz0 * ( c_3 - ( fz0 + fz0 ) );

	vx0 = glattice( ix, iy, iz, fx0, fy0, fz0, perm );
    vx1 = glattice( ix + 1, iy, iz, fx1, fy0, fz0, perm );
    vy0 = _lerp( wx, vx0, vx1 );
    vx0 = glattice( ix,iy + 1, iz, fx0, fy1, fz0, perm );
    vx1 = glattice( ix + 1, iy + 1, iz, fx1, fy1, fz0, perm );
    vy1 = _lerp( wx, vx0, vx1 );
    vz0 = _lerp( wy, vy0, vy1 );
    
    vx0 = glattice( ix, iy ,iz + 1, fx0, fy0, fz1, perm );
    vx1 = glattice( ix + 1,iy, iz + 1, fx1, fy0, fz1, perm );
    vy0 = _lerp( wx, vx0, vx1 );
    vx0 = glattice( ix,iy + 1,iz + 1, fx0, fy1, fz1, perm );
    vx1 = glattice( ix + 1,iy+1,iz + 1, fx1, fy1, fz1, perm );
    vy1 = _lerp( wx, vx0, vx1 );
    vz1 = _lerp( wy, vy0, vy1 );
    
    return _lerp( wz, vz0, vz1 );
}

END_MACHINE_NAMESPACE
